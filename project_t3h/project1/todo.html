<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />
    <title>Document</title>
  </head>
  <body>
    <style>
      .w-100 {
        width: 100%;
      }
      .al-right {
        text-align: right;
      }
      table tr th,
      table tr td {
        vertical-align: middle;
        padding: 10px 5px;
      }
      table tr th,
      .t-center {
        text-align: center;
      }
      #triangle-down {
        width: 0;
        height: 0;
        border-left: 7px solid transparent;
        border-right: 7px solid transparent;
        border-top: 10px solid black;
      }
      .dropdown ul {
        list-style: none;
      }
      .dropdown button {
        display: flex;
        align-items: center;
        justify-content: space-around;
      }
      .dropdown-item {
        cursor: pointer;
      }
      .dropdown-item:hover {
        background-color: lightblue;
      }
      .dropdown-item.active {
        background-color: #007db8;
        color: white;
      }
      #clock {
        position: sticky;
        background-color: white;
        top: 0;
        z-index: 9999999999;
        background: white;
      }
    </style>
    <h2 id="clock" class="ml-3 mt-3">00 : 00 : 00</h2>
    <div class="container mb-5">
      <div class="row mt-3">
        <div class="col-md-12">
          <h1>TODO List.</h1>
        </div>
      </div>
      <div class="row">
        <div class="col-md-10">
          <input
            class="form-control w-100"
            id="cv"
            placeholder="Bạn nhập việc cần làm..."
          />
        </div>
        <div class="col-md-2">
          <div class="dropdown">
            <button
              class="w-100 form-control"
              id="dropdownButton"
              aria-haspopup="true"
              aria-expanded="false"
              data-toggle="dropdown"
            >
              <span id="btn-content">Done</span><i id="triangle-down"></i>
            </button>
            <ul
              id="dropdown-option"
              class="dropdown-menu"
              aria-labelledby="dropdownButton"
            >
              <li
                class="dropdown-item active"
                onclick="changeStatus('Done',this)"
              >
                Done
              </li>
              <li class="dropdown-item" onclick="changeStatus('Todo',this)">
                Todo
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-md-12">
          <div class="button-group al-right">
            <button class="btn btn-primary" onclick="create()">Thêm mới</button>
            <button class="btn btn-primary" onclick="update()">Cập nhật</button>
            <button class="btn btn-primary" onclick="deleteItem()">Xóa</button>
          </div>
        </div>
      </div>

      <div class="row mt-5">
        <div class="col-md-12">
          <h3>2 Task(s)</h3>
        </div>
        <div class="col-md-12">
          <table border="1" class="w-100">
            <thead>
              <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Time</th>
              </tr>
            </thead>
            <tbody id="body">
              <tr>
                <td colspan="3" class="t-center"><i>No record found.</i></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <script>
      var storageIndex;
      function changeStatus(status, e) {
        document.getElementsByClassName("active")[0].classList.remove("active");
        e.classList.add("active");
        document.getElementById("btn-content").innerText = status;
      }
      $("#body tr:eq(1) td:eq(1)").text("Haha");

      function setClock() {
        setInterval(function () {
          //document.getElementById("clock").innerText= getTime();
          $("#clock").text(getTime());
          //clearTask();
        }, 1000);
      }
      function getTime() {
        var date = new Date();
        var h = date.getHours();
        var m = date.getMinutes();
        var s = date.getSeconds();
        return replaceTime(h) + " : " + replaceTime(m) + " : " + replaceTime(s);
      }
      function replaceTime(time) {
        return time < 10 ? "0" + time : time;
      }
      setClock();
      var dsach = [];
      var checkLS = localStorage.getItem("danhsach_congviec");
      if (checkLS != null) {
        dsach = [...JSON.parse(checkLS)];
      }
      function makeItem() {
        var name = document.getElementById("cv").value;
        var status = document.getElementById("btn-content").innerText;
        var time = document.getElementById("clock").innerText;
        var cv = {
          ten: name,
          trangthai: status,
          tgian: time,
        };
        return cv;
      }
      //Create
      function create() {
        dsach.push(makeItem());
        localStorageData();
        read();
      }
      //Localstorage
      function localStorageData() {
        localStorage.setItem("danhsach_congviec", JSON.stringify(dsach));
      }
      var isReverse = false;
      function reverseArray() {
        isReverse = !isReverse;
        read();
      }
      //Read
      function read() {
        var local = JSON.parse(localStorage.getItem("danhsach_congviec"));
        var trData = "";
        if (local != null) {
          //if(isReverse){
          //local=local.reverse();
          //}
          for (var i = local.length - 1; i >= 0; i--) {
            trData +=
              "<tr onclick='getDetail(" +
              i +
              ")' " +
              (local[i].trangthai.toLowerCase() == "over"
                ? "style='background-color:red'"
                : local[i].trangthai.toLowerCase() == "done"
                ? "style='background-color:green'"
                : "") +
              ">" +
              "<td>" +
              local[i].ten +
              "</td>" +
              "<td>" +
              local[i].trangthai +
              "</td>" +
              "<td>" +
              local[i].tgian +
              "</td>" +
              "</tr>";
          }
        }

        document.getElementById("body").innerHTML = trData;
      }
      function getDetail(currentIndex) {
        storageIndex = currentIndex;
        document.getElementById("cv").value = dsach[currentIndex].ten;
        //document.getElementById("cv").value=element.childNodes[0].innerText;
      }
      read();
      //Update
      function update() {
        var item = dsach[storageIndex];
        var newValue = makeItem();
        dsach[storageIndex] = newValue;
        localStorageData();
        read();
      }
      //Delete
      function deleteItem() {
        dsach.splice(storageIndex, 1);
        localStorageData();
        read();
      }
      function clearTask() {
        var date = new Date();
        var timeNow = getTime();
        var time1 = timeNow.split(":");
        var second = parseInt(time1[2]);
        var minutes = parseInt(time1[1]);
        for (let i = 0; i < dsach.length; i++) {
          var timeElement = dsach[i].tgian;
          var arr = timeElement.split(":");
          sec = parseInt(arr[2]);
          min = parseInt(arr[1]);
          if (minutes > min) {
            second = second + 60;
            if (second - sec >= 25) {
              //dsach.splice(dsach[i],1);
              dsach[i].trangthai = "Over";
            }
          }
          if (second - sec >= 25) {
            //dsach.splice(dsach[i],1);
            dsach[i].trangthai = "Over";
          }
        }
        read();
        localStorage.setItem("danhsach_congviec", JSON.stringify(dsach));
      }
    </script>
  </body>
</html>
